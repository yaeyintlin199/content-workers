npm warn Unknown env config "python". This will stop working in the next major version of npm.
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.

> test
> vitest run --test-timeout=0 --hook-timeout=0 --silent


 RUN  v3.1.2 /home/engine/project

 ✓ |@lucidcms/core| src/services/documents-bricks/helpers/construct-brick-table.test.ts (2 tests) 10ms
3:33:03 PM [vite] (ssr) warning: Duplicate member "metadata" in class body
290|      constructor(private pluginOptions?: Options) {}
291|  
292|      metadata(cb: (builder: PluginMetadataConfigurable) => void): PluginBuilder<Options> {
   |      ^
293|          const metadataBuilder = this.createMetadataBuilder();
294|          cb(metadataBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "recipe" in class body
296|      }
297|  
298|      recipe(recipe: LucidPluginRecipe): PluginBuilder<Options> {
   |      ^
299|          this.recipe = recipe;
300|          return this;

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "hooks" in class body
301|      }
302|  
303|      hooks(cb: (builder: PluginHooksConfigurable) => void): PluginBuilder<Options> {
   |      ^
304|          const configBuilder = this.createHooksBuilder();
305|          cb(configBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "routes" in class body
307|      }
308|  
309|      routes(cb: (builder: PluginRoutesConfigurable) => void): PluginBuilder<Options> {
   |      ^
310|          const configBuilder = this.createRoutesBuilder();
311|          cb(configBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "middleware" in class body
313|      }
314|  
315|      middleware(cb: (builder: PluginMiddlewareConfigurable) => void): PluginBuilder<Options> {
   |      ^
316|          const configBuilder = this.createMiddlewareBuilder();
317|          cb(configBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "services" in class body
319|      }
320|  
321|      services(cb: (builder: PluginServicesConfigurable) => void): PluginBuilder<Options> {
   |      ^
322|          const configBuilder = this.createServicesBuilder();
323|          cb(configBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
3:33:03 PM [vite] (ssr) warning: Duplicate member "admin" in class body
325|      }
326|  
327|      admin(cb: (builder: PluginAdminConfigurable) => void): PluginBuilder<Options> {
   |      ^
328|          const configBuilder = this.createAdminBuilder();
329|          cb(configBuilder);

  Plugin: vite:esbuild
  File: /home/engine/project/packages/plugin-sdk/src/builder.ts
 ❯ |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts (14 tests | 14 failed) 17ms
   × Plugin SDK > createPlugin > should create a basic plugin 6ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with all metadata 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with a recipe 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with hooks 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with routes 0ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with middleware 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with services 0ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with admin configuration 0ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should create a plugin with compatibility checker 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should support plugin options 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should handle empty arrays and objects correctly 0ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should build fluent API correctly 0ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > createPlugin > should generate valid LucidPluginManifest 1ms
     → (0 , createPlugin)(...).metadata is not a function
   × Plugin SDK > type safety > should provide proper TypeScript types 2ms
     → (0 , createPlugin)(...).metadata is not a function
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/media.test.ts (3 tests) 13ms
 ✓ |@lucidcms/core| src/utils/helpers/group-document-filters.test.ts (10 tests) 9ms
 ✓ |@lucidcms/core| src/libs/builders/field-builder/field-builder.test.ts (3 tests) 7ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/datetime.test.ts (3 tests) 9ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/text.test.ts (3 tests) 9ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/wysiwyg.test.ts (3 tests) 8ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/link.test.ts (3 tests) 13ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/textarea.test.ts (3 tests) 8ms
 ✓ |@lucidcms/core| src/utils/services/service-wrapper.test.ts (5 tests) 1346ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/json.test.ts (3 tests) 12ms
 ✓ |@lucidcms/core| src/services/documents-bricks/helpers/prepare-bricks-and-fields.test.ts (3 tests) 4ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/color.test.ts (3 tests) 6ms
 ✓ |@lucidcms/core| src/services/documents-bricks/checks/check-validate-bricks-fields.test.ts (1 test) 9ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/number.test.ts (3 tests) 8ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/select.test.ts (3 tests) 8ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/document.test.ts (3 tests) 6ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/user.test.ts (3 tests) 6ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/checkbox.test.ts (3 tests) 8ms
 ✓ |@lucidcms/core| src/services/documents-bricks/helpers/process-field-values.test.ts (6 tests) 4ms
 ✓ |@lucidcms/core| src/libs/email-adapter/templates/replace-template-vars.test.ts (10 tests) 3ms
 ✓ |@lucidcms/core| src/libs/plugins/__tests__/plugin-manager.test.ts (6 tests) 14ms
 ✓ |@lucidcms/core| src/libs/builders/collection-builder/collection-builder.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/collection/schema/infer-schema.test.ts (5 tests) 15ms
 ✓ |@lucidcms/plugin-pages| src/utils/build-fullslug-from-slugs.test.ts (2 tests) 2ms
 ✓ |@lucidcms/core| src/libs/builders/brick-builder/brick-builder.test.ts (4 tests) 4ms
 ✓ |@lucidcms/core| src/utils/client-integrations/encode-api-key.test.ts (3 tests) 3ms
 ✓ |@lucidcms/core| src/libs/builders/collection-builder/schema.test.ts (1 test) 6ms
 ✓ |@lucidcms/core| src/libs/repositories/collection-migrations.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/client-integrations.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/media-awaiting-sync.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/user-auth-providers.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/email-transactions.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/media-translations.test.ts (1 test) 5ms
 ✓ |@lucidcms/core| src/libs/repositories/media-share-links.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/processed-images.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/role-permissions.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/media-folders.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/collections.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/auth-states.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/user-logins.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/user-tokens.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/queue-jobs.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/user-roles.test.ts (1 test) 5ms
 ✓ |@lucidcms/core| src/libs/repositories/locales.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/options.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/emails.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/media.test.ts (1 test) 4ms
 ✓ |@lucidcms/core| src/libs/repositories/roles.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/repositories/users.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/repeater.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/config/mock-config/check-plugin-semver.test.ts (1 test) 1578ms
   ✓ should throw lucid version support error  1577ms
 ✓ |@lucidcms/core| src/libs/builders/brick-builder/schema.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/config/load-config-file.test.ts (2 tests) 1733ms
   ✓ should return lucid config object  1650ms
 ✓ |@lucidcms/core| src/libs/custom-fields/fields/tab.test.ts (1 test) 3ms
 ✓ |@lucidcms/core| src/libs/config/get-config-path.test.ts (2 tests) 5ms
 ✓ |@lucidcms/core| src/libs/config/mock-config/duplicate-collection-fields.test.ts (1 test) 1441ms
   ✓ should throw duplicate collection field key error  1440ms
 ✓ |@lucidcms/core| src/libs/config/mock-config/duplicate-collections.test.ts (1 test) 1535ms
   ✓ should throw duplicate collection key error  1534ms
 ✓ |@lucidcms/admin| src/utils/__tests__/plugin-manifest.test.ts (7 tests) 5ms

⎯⎯⎯⎯⎯⎯ Failed Tests 14 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a basic plugin
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:8:18
      6|         it("should create a basic plugin", () => {
      7|             const plugin = createPlugin()
      8|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
      9|                 .build();
     10| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with all metadata
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:19:18
     17|         it("should create a plugin with all metadata", () => {
     18|             const plugin = createPlugin()
     19|                 .metadata((metadata) =>
       |                  ^
     20|                     metadata
     21|                         .key("test-plugin")

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with a recipe
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:43:18
     41|             const recipe = vi.fn();
     42|             const plugin = createPlugin()
     43|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
     44|                 .recipe(recipe)
     45|                 .build();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with hooks
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:57:18
     55| 
     56|             const plugin = createPlugin()
     57|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
     58|                 .hooks((hooks) => {
     59|                     hooks.init(initHook);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with routes
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:76:18
     74| 
     75|             const plugin = createPlugin()
     76|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
     77|                 .routes((routes) => {
     78|                     routes.add(route1);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with middleware
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:95:18
     93| 
     94|             const plugin = createPlugin()
     95|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
     96|                 .middleware((middleware) => {
     97|                     middleware.add(middleware1);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with services
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:114:18
    112| 
    113|             const plugin = createPlugin()
    114|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
    115|                 .services((services) => {
    116|                     services.add("service1", service1);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with admin configuration
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:131:18
    129|         it("should create a plugin with admin configuration", () => {
    130|             const plugin = createPlugin()
    131|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
    132|                 .admin((admin) => {
    133|                     admin.entry("/admin/test-plugin");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should create a plugin with compatibility checker
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:186:18
    184| 
    185|             const plugin = createPlugin()
    186|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
    187|                 .checkCompatibility((checkerFn) => {
    188|                     checkerFn(checker);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should support plugin options
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:206:18
    204|                 apiKey: "test-key",
    205|             })
    206|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
    207|                 .recipe(recipe)
    208|                 .build();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should handle empty arrays and objects correctly
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:217:18
    215|         it("should handle empty arrays and objects correctly", () => {
    216|             const plugin = createPlugin()
    217|                 .metadata((metadata) => metadata.key("test-plugin"))
       |                  ^
    218|                 .build();
    219| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should build fluent API correctly
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:231:18
    229|         it("should build fluent API correctly", () => {
    230|             const plugin = createPlugin()
    231|                 .metadata((metadata) => {
       |                  ^
    232|                     metadata.key("test-plugin");
    233|                     metadata.name("Test Plugin");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > createPlugin > should generate valid LucidPluginManifest
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:263:18
    261|         it("should generate valid LucidPluginManifest", () => {
    262|             const plugin = createPlugin()
    263|                 .metadata((metadata) => {
       |                  ^
    264|                     metadata.key("test-plugin");
    265|                     metadata.name("Test Plugin");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/14]⎯

 FAIL  |@lucidcms/plugin-sdk| test/plugin-sdk.test.ts > Plugin SDK > type safety > should provide proper TypeScript types
TypeError: (0 , createPlugin)(...).metadata is not a function
 ❯ test/plugin-sdk.test.ts:297:18
    295|                 apiKey: "test-key",
    296|             })
    297|                 .metadata((metadata) => {
       |                  ^
    298|                     metadata.key("typed-plugin");
    299|                     metadata.name("Typed Plugin");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/14]⎯


 Test Files  1 failed | 59 passed (60)
      Tests  14 failed | 140 passed (154)
   Start at  15:33:01
   Duration  33.56s (transform 4.41s, setup 159ms, collect 34.66s, tests 7.95s, environment 908ms, prepare 7.46s)

